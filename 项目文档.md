# 目录

1. 服务功能
2. 客户端操作全过程
3. 接口需求

# 1.服务功能

- 客户端：负责发送请求。此处的用户有三种身份：匿名用户、普通用户、超级用户。
- 网关：只负责转发消息。
- 界面初始化：只在最初登录时使用，负责传输html文件。
- 检索信息管理：用户的检索信息包括热点检索、文本检索、图片检索。检索信息管理服务负责将这些消息分类并发送给对应的处理服务，将这些处理服务返回的消息整合并回传。
- 热点处理：负责维护热点搜索数据库，检索信息管理服务会将用户的检索和点击发送过来，热点处理根据不同权值为热点排序。同时热点搜索负责寻找热点发送给检索信息管理服务。未来可能会加入根据用户偏好定制热点的功能。
- 文本信息处理：负责文本解析，分词，关键词过滤等功能。
- 图片特征提取：负责图片特征提取。
- id/文本搜索：支持两种搜索图文数据库的方式。
- 图片搜索：根据图片特征检索图文数据库。
- 用户数据处理：用户的注册、登录、切换账号、注销，以及收藏夹的操作均在这里实现。
- 管理员模式：超级用户通过管理员模式写数据库。
- 热点搜索数据库：用户的搜索与点击都会被转化为分数值记录在这里。
- 图文数据库：记录数据的id、文本、图片url、图片缩略图、图片特征等信息。
- 用户数据库：记录用户信息、权限、收藏夹等信息。
- ETCD：服务注册与服务发现。

# 2.客户端操作全过程

>第一次登录：**客户端**从浏览器输入**网关**的ip和端口号，经由1、2到达**界面初始化服务**。**界面初始化服务**会把所有的界面信息与逻辑发给用户。
>获取热点：界面初始化成功以及每次刷新时**客户端**会自动检索一次空字符串，结合自己的身份信息发送给**检索信息管理服务**。如果是匿名用户的请求，**检索信息管理服务**会直接向**热点处理服务**请求热点信息，如果是注册用户，**检索信息管理服务**会向**用户数据处理服务**请求用户偏好，这需要检索**用户数据库**，然后将偏好发送给**热点处理服务**。**热点处理服务**寻找符合用户偏好的热点返回。
>文本检索：**客户端**发送检索时间、检索文本至**网关**，经由**检索信息管理服务**，**文本信息处理服务**，**文本搜索**等服务获得检索结果。返回给客户端的结果包括检索时间、检索文本、检索结果等信息，保证客户端界面稳定显示。
>图片检索：流程与文本检索相似。
>用户注册、登录、切换账号、注销的操作都会被转发到**用户数据处理服务**。**用户数据处理服务**可以读写**用户数据库**。账号的切换会刷新页面，重新读取热点信息。
>收藏夹信息存于用户数据库，包含所属用户以及内部文件的信息。
>用户通过登录或切换成管理员会刷新页面并获得修改热点搜索数据库和图文数据库的权限。但每次请求都会被传给**用户数据处理服务**，**用户数据处理**判断用户权限并考虑是否需要进入**管理员模式**。只有进入管理员模式才能对**热点搜素数据库**和**图文数据库**进行修改。

# 3.接口需求

<table>
  <tr>
    <th>位置</th>
    <th>功能</th>
    <th>请求</th>
    <th>响应</th>
  </tr>
  <tr>
    <td rowspan="12">1</td>
    
    <td>获取页面</td>
    <td>get页面url</td>
    <td>html文件</td>
    
    <td>热点检索</td>
    <td>用户信息、检索值</td>
    <td>热点信息</td>
    
    <td>文本检索</td>
    <td>检索时间、检索文本</td>
    <td>检索时间、检索文本、检索结果列表</td>
    
    <td>图片检索</td>
    <td>检索时间、图片信息</td>
    <td>检索时间、图片信息、检索结果列表</td>
    
    <td>注册</td>
    <td>用户名、密码</td>
    <td>注册结果</td>
    
    <td>登录、切换账号</td>
    <td>用户名、密码</td>
    <td>登录结果</td>
    
    <td>注销</td>
    <td>用户名、注销操作编码、空参数</td>
    <td>注销结果</td>
    
    <td>新建收藏夹</td>
    <td>用户名、新建收藏夹操作编码、空参数</td>
    <td>新建结果</td>
    
    <td>重命名收藏夹</td>
    <td>用户名、重命名收藏夹编码、收藏夹id+新命名</td>
    <td>重命名收藏结果</td>
    
    <td>删除收藏夹</td>
    <td>用户名、删除收藏夹操作码、收藏夹id</td>
    <td>删除收藏夹结果</td>
    
    <td>添加收藏</td>
    <td>用户名、添加收藏编码、收藏夹id+被收藏内容id</td>
    <td>收藏结果</td>
    
    <td>删除收藏</td>
    <td>用户名、删除收藏编码、收藏夹id+被收藏内容id</td>
    <td>删除收藏结果</td>
  </tr>
</table>
  
